<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOMADS</title>

    <!-- === Full Screen Mobile App Settings === -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Nomad's">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/1a110a/f59e0b?text=N">
    
    <!-- === Styles and Fonts === -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Bangers&family=Creepster&family=Metal+Mania&family=Nosifier&family=Permanent+Marker&family=Roboto+Condensed:wght@700&family=Rye&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a110a; /* Dark wood */
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://images.unsplash.com/photo-1541813449333-a217278f93d3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80');
            background-attachment: fixed;
            overflow: hidden; /* Prevent body scroll */
            background-size: cover;
            background-position: center;
        }
        .app-container { display: flex; flex-direction: column; height: 100vh; }
        main { flex-grow: 1; overflow: hidden; position: relative; }
        .font-rye { font-family: 'Rye', cursive; }
        .font-black-ops { font-family: 'Black Ops One', cursive; }
        
        #header-logo-container {
            position: relative;
            background-image: url('https://scontent-iad3-1.xx.fbcdn.net/v/t39.30808-6/560249362_1334414134750721_6442249990351217830_n.jpg?stp=cp6_dst-jpg_tt6&_nc_cat=101&ccb=1-7&_nc_sid=833d8c&_nc_ohc=CM3uAcZwDy0Q7kNvwH9N7J1&_nc_oc=Adm6pra2I-wIN54zlYEGN-q1sFOLdiKIZ7soVqhrp2gPTB4Mju67Q2FgLk0jjRLpvlg&_nc_zt=23&_nc_ht=scontent-iad3-1.xx&_nc_gid=DjeS81jUBoCZUFrHpc9egw&oh=00_Afcu7dpsQ4ErpnKzS14njbcjQ0neAcvcnI0k3pCVDbdJQg&oe=68EBA766');
            background-size: cover; background-position: center top; background-repeat: no-repeat;
            border-radius: 0.5rem; box-shadow: 0 8px 16px rgba(0,0,0,0.8); overflow: hidden;
        }
        #header-logo-container::before {
            content: ''; position: absolute; inset: 0;
            background-color: rgba(0, 0, 0, 0.5); box-shadow: inset 0 0 20px rgba(0,0,0,0.9);
            border: 2px solid #4b5563; border-radius: 0.5rem;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.7) 70%, rgba(0, 0, 0, 0.9) 100%);
        }
        #header-logo-container h1 {
            position: relative; font-family: 'Black Ops One', cursive; font-size: 2.5rem; color: #f59e0b;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.9), 0 0 15px #f59e0b; letter-spacing: 0.1em; z-index: 10; line-height: 1;
        }
        @media (max-width: 480px) { #header-logo-container h1 { font-size: 2rem; } }
        
        #menu-grid {
            display: flex; gap: 1.5rem; overflow-x: auto; scroll-snap-type: x mandatory;
            scroll-padding: 1rem; -webkit-overflow-scrolling: touch; padding: 1rem; height: 100%;
        }
        #menu-grid::-webkit-scrollbar { display: none; }
        #menu-grid { -ms-overflow-style: none; scrollbar-width: none; }

        .drink-card {
            flex: 0 0 88%; scroll-snap-align: center; perspective: 1500px;
            background-color: transparent; min-height: 490px; transition: opacity 0.3s;
        }
        @media (min-width: 640px) { .drink-card { flex-basis: 70%; } }
        @media (min-width: 1024px) { .drink-card { flex-basis: 50%; } }
        .drink-card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.7s, box-shadow 0.4s ease-in-out;
            transform-style: preserve-3d; box-shadow: 0 8px 20px rgba(0,0,0,0.7); border-radius: 0.5rem;
        }
        .drink-card.is-flipped .drink-card-inner { transform: rotateY(180deg); }
        .drink-card.is-highlighted .drink-card-inner {
            box-shadow: 0 0 25px 8px rgba(245, 158, 11, 0.7); transform: scale(1.02);
        }

        .drink-card-front, .drink-card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; flex-direction: column; overflow: hidden; border-radius: 0.5rem;
            background-color: #5d4037;
            background-image: radial-gradient(circle at center, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.25)), url('https://www.transparenttextures.com/patterns/leather.png');
            border: 4px solid #3e2723; box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        .drink-card-back {
            transform: rotateY(180deg); background-image: radial-gradient(ellipse at top, #3a2a1a, #1a110a);
            border: 3px solid; border-image-slice: 1;
            border-image-source: linear-gradient(to bottom right, #c0842b, #854d0e);
        }
        .drink-card.is-unavailable { opacity: 0.4; pointer-events: none; }
        .drink-card-title {
            font-size: 1.8rem; line-height: 1.2; color: #f59e0b; text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(245, 158, 11, 0.5);
        }
        .card-footer {
            text-align: center; font-size: 0.75rem; color: #9ca3af; padding: 0.5rem;
            font-family: 'Rye', cursive; letter-spacing: 0.05em; flex-shrink: 0;
            background: rgba(0,0,0,0.2); border-top: 1px solid #4a2c2a;
        }
        .card-header-front {
            padding: 0.75rem; background: rgba(0,0,0,0.3); border-bottom: 2px solid;
            border-image-slice: 1; border-image-source: linear-gradient(to right, #c0842b, #854d0e);
            box-shadow: 0 4px 6px rgba(0,0,0,0.4); flex-shrink: 0;
        }
        .recipe-content { flex-grow: 1; overflow-y: auto; padding: 0.5rem 0.75rem; min-height: 0; }
        .recipe-content-title {
            font-family: 'Black Ops One', cursive; color: #c0842b; font-size: 0.875rem;
            text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.75rem;
            padding-bottom: 0.25rem; border-bottom: 1px dashed #4b5563;
        }
        .recipe-list-front { list-style: none; padding: 0; }
        .recipe-list-front li {
            display: flex; align-items: center; font-family: 'Roboto Condensed', sans-serif;
            font-size: 0.9rem; letter-spacing: 0.02em; margin-bottom: 0.3rem; color: #d1d5db;
        }
        .recipe-list-front li i { width: 24px; text-align: center; margin-right: 0.75rem; font-size: 0.9rem; }
        
        .modal { transition: opacity 0.3s ease-in-out; }
        .ingredient-btn.out-of-stock { opacity: 0.5; background-color: #374151; text-decoration: line-through; }
        .ingredient-btn.out-of-stock:hover { background-color: #4b5563; }
        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(17, 24, 39, 0.7);
            color: #d1d5db; border: 2px solid #4b5563; border-radius: 50%; width: 44px; height: 44px;
            font-size: 1.5rem; cursor: pointer; z-index: 20; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .nav-arrow:hover { background-color: rgba(245, 158, 11, 0.8); color: #111827; }
        #arrow-left { left: 10px; } #arrow-right { right: 10px; }

        #bottom-nav { box-shadow: 0 -4px 15px -5px rgba(0,0,0,0.7); }
        .bottom-nav-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 4px 0; border-radius: 0.5rem; color: #d1d5db; transition: all 0.2s ease-in-out;
        }
        .bottom-nav-btn:hover, .bottom-nav-btn.is-active {
            background-color: rgba(55, 65, 81, 0.5); color: #f59e0b;
            text-shadow: 0 0 6px rgba(245, 158, 11, 0.7);
        }

        #category-filter-container {
            display: flex; overflow-x: auto; padding: 0 1rem 0.75rem 1rem;
            gap: 0.75rem; -webkit-overflow-scrolling: touch;
        }
        #category-filter-container::-webkit-scrollbar { display: none; }
        #category-filter-container { -ms-overflow-style: none; scrollbar-width: none; }
        .category-pill {
            flex: 0 0 auto; padding: 0.5rem 1rem; border: 2px solid #4b5563;
            border-radius: 9999px; background-color: transparent; color: #d1d5db;
            font-weight: 600; cursor: pointer; transition: all 0.2s ease-in-out; white-space: nowrap;
        }
        .category-pill:hover { background-color: #4b5563; border-color: #6b7280; }
        .category-pill.is-active {
            background-color: #f59e0b; color: #111827; border-color: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }
    </style>
</head>
<body class="antialiased text-gray-300">

    <div class="app-container">
        <header class="text-center my-4 px-4 flex-shrink-0">
            <div id="header-logo-container" class="h-32 md:h-40 w-full max-w-lg mx-auto flex items-center justify-center">
               <h1 class="drop-shadow-lg">NOMADS</h1>
            </div>
        </header>
        
        <div id="category-filter-container" class="flex-shrink-0"></div>

        <main>
            <div id="menu-grid"></div>
            <button id="arrow-left" class="nav-arrow"><i class="fas fa-chevron-left"></i></button>
            <button id="arrow-right" class="nav-arrow"><i class="fas fa-chevron-right"></i></button>
        </main>

        <footer id="bottom-nav" class="flex-shrink-0 bg-black/90 backdrop-blur-md border-t-2 border-amber-800 grid grid-cols-4 gap-2 p-2 z-20">
            <button id="home-btn" class="bottom-nav-btn is-active">
                <i class="fas fa-users text-2xl"></i><span class="text-xs">Clubhouse</span>
            </button>
            <button id="drink-finder-btn" class="bottom-nav-btn">
                <i class="fas fa-compass text-2xl"></i><span class="text-xs">Finder</span>
            </button>
            <button id="roll-dice-btn" class="bottom-nav-btn">
                <i class="fas fa-dice text-2xl"></i><span class="text-xs">Roll Dice</span>
            </button>
            <button id="bar-stock-btn" class="bottom-nav-btn">
                <i class="fas fa-wine-bottle text-2xl"></i><span class="text-xs">Stock</span>
            </button>
        </footer>
    </div>

    <!-- Modals -->
    <div id="bar-stock-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[95vh] flex flex-col border border-gray-600">
            <div class="p-6 border-b border-gray-600 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white font-black-ops">Bar Stock</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="bar-stock-content" class="p-6 text-gray-300 overflow-y-auto">
                <div>
                    <h3 class="text-xl text-green-400 mb-4 font-black-ops">IN STOCK</h3>
                    <div id="in-stock-lists"></div>
                </div>
                <div class="border-t-2 border-dashed border-gray-600 my-6"></div>
                <div>
                    <h3 class="text-xl text-red-400 mb-4 font-black-ops">OUT OF STOCK</h3>
                    <div id="out-of-stock-lists"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="drink-finder-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[95vh] flex flex-col border border-gray-600">
            <div class="p-6 border-b border-gray-600">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-white font-black-ops">Drink Finder</h2>
                    <button id="close-finder-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
                <p class="text-gray-400 mt-1">Select the flavors you're craving to find your next drink.</p>
            </div>
            <div id="drink-finder-content" class="p-6 text-gray-300 overflow-y-auto">
                <div>
                    <h3 class="text-xl text-amber-500 mb-4 font-rye">Choose Your Flavors</h3>
                    <div id="finder-flavor-tags" class="flex flex-wrap gap-3"></div>
                </div>
                <div class="border-t-2 border-dashed border-gray-600 my-6"></div>
                <div>
                    <h3 class="text-xl text-green-400 mb-4 font-rye">Matching Drinks</h3>
                    <div id="finder-results" class="space-y-3"><p class="text-gray-500 italic">Results will appear here...</p></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const cocktails = [
            { name: "Redheaded Trouble", category: ["signature", "schnapps"], flavorProfile: "Herbal & Peach", recipe: ["1 oz Jägermeister", "1 oz Peach Schnapps", "Fill a tall glass with Orange Juice"], story: "A redhead named Roxy used to ride a custom Triumph. She'd order three of these at a time: one for her, one for 'the road,' and one for 'the trouble she was about to cause.' Last we saw her, she was out-running a sheriff on a gravel road, laughing the whole damn way." },
            { name: "Caramel Apple Cruiser", category: ["signature", "schnapps"], flavorProfile: "Sweet & Tart", recipe: ["1 oz Butterscotch Schnapps", "1 oz Apple Pucker", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This is for the guy on the candy-apple red cruiser that looks all show, no go. Then he takes it to the drag strip and leaves everyone in his dust. This drink is the same - looks innocent, but that spicy kick from the bitters will get you from zero to sixty before you know it." },
            { name: "Irish Russian", category: ["signature", "vodka", "schnapps"], flavorProfile: "Creamy Coffee", recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream", "0.25 oz Simple Syrup", "Fill a tall glass with Club Soda"], story: "We invented this for a biker from Boston who couldn't decide between his two heritages. He'd slam one down and say it was for 'the fightin' Irish and the cold-hearted Russian' in him. Said it was the only way to get them to agree on anything." },
            { name: "Purple Hooter", category: ["signature", "vodka", "schnapps"], flavorProfile: "Raspberry & Floral", recipe: ["1 oz Ketel One Vodka", "1 oz Raspberry Schnapps", "2 dashes Peychaud's Bitters", "Splash Lime Juice", "Fill a tall glass with Club Soda"], story: "We only serve this after we've taken your keys. A group of riders came through once, had a few of these, and tried to pay with a live armadillo. They seemed to think it was a good idea at the time. The armadillo, and the sheriff, disagreed. The bitters are a reminder of that bitter regret." },
            { name: "The Ghost Rider", category: ["signature", "tequila", "schnapps"], flavorProfile: "Herbal & Anise", recipe: ["1 oz Pernod", "2 oz Jose Cuervo Silver Tequila", "Fill a tall glass with Club Soda", "Splash of Lime Juice"], story: "Named for a mysterious rider on a flaming bike who only ever ordered one thing. It's sharp, herbal, and leaves an otherworldly impression, just like him." },
            { name: "The Phantom Shift", category: ["signature", "gin", "schnapps"], flavorProfile: "Anise & Crisp", recipe: ["1 oz Pernod", "1 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass"], story: "They say if you're on a lonely road at midnight, you can sometimes feel a bike shift gears right next to you, even when no one's there. This drink is for that feeling—anise-forward, sharp, and gone before you can place it. It's the taste of a legend riding alongside you." },
            { name: "The White Liner", category: ["signature", "gin", "schnapps"], flavorProfile: "Crisp & Floral", recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.75 oz Lemon Juice", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "For the rider who stays true to their path. This drink is just as clean and direct—a crisp, floral shot of gin and elderflower that keeps you on the straight and narrow. No detours, no distractions, just the pure taste of the open road ahead." },
            { name: "The Junk Drawer", category: ["signature", "schnapps"], flavorProfile: "Very Sweet", recipe: ["0.75 oz Raspberry Schnapps", "0.75 oz Butterscotch Schnapps", "0.75 oz Root Beer Schnapps", "Fill a tall glass with Club Soda"], story: "You know that drawer in your garage with all the leftover parts? This is the liquid version. It sounds like it shouldn't work, but one sip and you'll realize it's a custom build that's more than the sum of its parts." },
            { name: "The Blue Lagoon's Ghost", category: ["signature", "rum", "schnapps"], flavorProfile: "Tropical Cherry", recipe: ["1.5 oz Bacardi Rum", "0.5 oz Blue Curacao", "0.5 oz Maraschino Liqueur", "Splash Lime Juice"], story: "A rider swore he saw a ghost ship on a moonlit ride along the coast. He came in and asked for a drink that tasted like the tropics, but with a haunting finish. This is it. Bright, fruity, and mysteriously complex." },
            { name: "Two Kings", category: ["signature", "whiskey"], flavorProfile: "Bold & Smooth", recipe: ["1 oz Knob Creek", "1 oz Crown Royal", "Top with Club Soda in a tall glass"], story: "For when you can't decide which king to follow. This drink pays tribute to both the rugged power of Kentucky and the smooth royalty of the North. It's a simple, powerful statement." },
            { name: "The Double Cross", category: ["signature", "whiskey", "schnapps"], flavorProfile: "Bitter & Salty", recipe: ["2 oz Bulleit Bourbon", "1 oz Campari", "Half Salt, Half Sugar Rim"], story: "For the rider who plays both sides. It's a bitter pill to swallow, but the conflicting rim reminds you that every betrayal has its sweet and salty moments. Trust no one." },
            { name: "The Blacktop Sunset", category: ["signature", "whiskey"], flavorProfile: "Sweet & Spicy", recipe: ["1 oz Jameson Irish Whiskey", "1 oz Southern Comfort", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "For that moment the sun dips below the horizon and paints the blacktop gold. It's the taste of a successful haul—smooth whiskey, the sweet memory of the day, and a spicy kick to remind you that tomorrow's another ride." },
            { name: "The Elderflower Nomad", category: ["signature", "gin", "schnapps"], flavorProfile: "Floral & Herbal", recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.5 oz Lime Juice", "2 dashes Rosemary Lavender Bitters", "Top with Club Soda in a tall glass"], story: "For the rider who takes the scenic route, not the highway. It’s a complex, floral journey in a glass, a taste of wild elderflower fields discovered on a long-forgotten backroad. It doesn't rush." },
            { name: "Finn's Orchard Kick", category: ["signature", "whiskey", "schnapps"], flavorProfile: "Tart & Spicy", recipe: ["2 oz Jameson Irish Whiskey", "1 oz Apple Pucker", "2 dashes Angostura Bitters", "Top with Ginger Soda in a tall glass"], story: "An Irish rider named 'Finn' brought this idea in. Said it reminded him of home, but with an edge. The bitters give it a spiced, unexpected kick for those who look easy-going, but have a sharp turn if you cross them. Like Finn himself." },
            { name: "The Apparition", category: ["vodka", "schnapps"], flavorProfile: "Floral & Spicy", recipe: ["2 oz Ketel One Vodka", "0.75 oz St-Germain", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "For the rider who seems to show up out of nowhere and disappear just as fast. It's smooth, with a floral note you can't quite place, and a spicy finish. By the time you figure it out, it's already a memory." },
            { name: "Black-Top Burner", category: ["vodka", "schnapps"], flavorProfile: "Bold & Herbal", recipe: ["1.5 oz Grey Goose Vodka", "0.5 oz Jägermeister", "Fill a tall glass with Cola"], story: "Named for the burnout marks left by a local legend's panhead. It’s dark, aggressive, and leaves a lasting impression. It's not a drink for making friends, it's for making a statement." },
            { name: "The Mechanic", category: ["vodka", "schnapps"], flavorProfile: "Citrus & Sour", recipe: ["2 oz Stolichnaya Citros Vodka", "1 oz Blue Curacao", "2 dashes Orange Bitters", "Fill a tall glass with Sour Mix"], story: "An old-timer named Gus, who could fix a Harley with a paperclip and a prayer, used to drink this. Said the color reminded him of windshield washer fluid, but the bitters gave it the 'penetrating oil' kick it needed. It’s surprisingly effective and gets you running smoother than you have any right to." },
            { name: "Redline Riot", category: ["vodka", "schnapps"], flavorProfile: "Sweet Cherry & Sour", recipe: ["1.5 oz Ketel One Vodka", "1 oz Cherry Schnapps", "Fill a tall glass with Sour Mix", "Splash of Lime Juice"], story: "You know that feeling when you push the engine to its limit, just before you shift? The vibration, the roar, the pure power? We bottled that feeling. This drink does not whisper. It's for when you want to feel the engine scream." },
            { name: "The Kickstart", category: ["rum"], flavorProfile: "Spiced Ginger", recipe: ["2 oz Captain Morgan Spiced Rum", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "For those cold mornings when the engine won't turn over. This ain't coffee. It's a jolt of spiced rum and ginger that'll kickstart your heart and get you back on the road. Guaranteed to fire on the first try." },
            { name: "The Castaway", category: ["rum"], flavorProfile: "Tropical & Spiced", recipe: ["2 oz Captain Morgan Spiced Rum", "1 oz Pineapple Juice", "0.5 oz Orange Juice", "2 dashes Angostura Bitters", "Splash of Grenadine", "Top with Club Soda in a tall glass"], story: "A guy who rode in from the coast, salty and sun-beaten, asked for something that tasted like being stranded in paradise. This is it. Sweet, fruity, and just a little bit dangerous—the bitters add that note of 'I survived a shipwreck to get here.' It’s a vacation in a glass." },
            { name: "Storm Rider", category: ["rum"], flavorProfile: "Dark & Spiced", recipe: ["2 oz Kraken Black Spiced Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This one's for the riders who don't pull over when the sky turns black. They lean into the wind and chase the storm. It’s dark, spicy, and has a kick that’ll rattle your bones. The Kraken rum adds the dark, mythical power of the deep, making this a taste of the storm itself." },
            { name: "The Kraken's Grip", category: ["rum", "schnapps"], flavorProfile: "Dark & Nutty", recipe: ["1.5 oz Kraken Black Spiced Rum", "1 oz Amaretto", "Fill a tall glass with Cola"], story: "A sailor-turned-biker with a kraken tattooed up his arm brought this recipe in. He said it was dark, mysterious, and had a grip that wouldn't let go, just like the beast on his skin. He wasn't wrong. Approach with caution." },
            { name: "The Siren's Call", category: ["rum", "schnapps"], flavorProfile: "Tropical & Bitter", recipe: ["1.5 oz Kraken Black Spiced Rum", "0.75 oz Campari", "1.5 oz Pineapple Juice", "0.5 oz Lime Juice"], story: "A salty old road dog who'd been a sailor in another life brought this one in. He said it tastes like a beautiful island that you know you should never land on. Sweet at first, but the bitter finish pulls you under. It's a beautiful trap." },
            { name: "The Island Hopper", category: ["rum", "signature"], flavorProfile: "Tropical Coconut", recipe: ["1 oz Malibu Rum", "1 oz Bacardi Rum", "Fill with Pineapple Juice", "Splash of Lime Juice"], story: "A sun-bleached rider on a chopper with surfboard racks brought this recipe in. Said it tastes like escaping the mainland for good. One sip and you're on island time, no turning back." },
            { name: "The Switchback", category: ["gin"], flavorProfile: "Sharp & Clean", recipe: ["2 oz Tanqueray Gin", "1 oz Lime Juice", "Fill a tall glass with Club Soda"], story: "Named for those tight, winding mountain roads that demand your full attention. This drink is just as sharp and clean. No nonsense, just a crisp, straightforward kick that'll wake you up. Underestimate it, and you'll end up in the weeds." },
            { name: "The Long Haul", category: ["gin"], flavorProfile: "Crisp & Herbal", recipe: ["2 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass", "2 dashes Rosemary Lavender Bitters"], story: "This is the go-to for the old-timers who've seen every mile of Route 66. It's crisp and refreshing, but that herbal kick from the bitters is a reminder of the high-desert sagebrush you ride through. It's not a sprint, it's a marathon, and this is your fuel." },
            { name: "The Barbed Wire", category: ["gin", "schnapps"], flavorProfile: "Herbal & Prickly", recipe: ["1.5 oz Tanqueray Gin", "0.5 oz Jägermeister", "Fill a tall glass with Tonic Water"], story: "Some trails are best left untraveled. A grizzled old rider they called 'Barbs' used to drink this. Said it tasted like a shortcut through a rancher's fence—sharp, herbal, and you feel every bit of it. It's for when you know the easy way is the wrong way." },
            { name: "The Rattlesnake", category: ["tequila", "schnapps"], flavorProfile: "Sweet Cherry & Sharp", recipe: ["2 oz El Mayor Tequila", "0.5 oz Cherry Schnapps", "0.5 oz Lime Juice", "Top with Club Soda in a tall glass"], story: "You never hear the one that gets you. An old prospector-turned-biker brought this recipe in. Said it's like a desert rattler—brightly colored to warn you off, but if you get too close, the tequila bite is fast and the cherry venom follows. It demands respect." },
            { name: "Dust Devil", category: ["tequila", "schnapps"], flavorProfile: "Tropical & Bitter", recipe: ["2 oz Jose Cuervo Silver Tequila", "1 oz Pineapple Juice", "0.5 oz Maraschino Liqueur", "Dash of Orange Bitters", "Top with Club Soda in a tall glass"], story: "For those days when the road is long and the dust is thick. This drink is a whirlwind of sweet and bitter that'll pick you up, spin you around, and set you back down a little dazed but ready for more. It's a taste of the wild frontier." },
            { name: "Desert Sunrise", category: ["tequila"], flavorProfile: "Sweet Citrus", recipe: ["2 oz El Mayor Tequila", "Fill a tall glass with Orange Juice", "2 dashes Orange Bitters", "0.5 oz Grenadine"], story: "For the rider who's seen the sun come up over the desert plains one too many times. It's a reminder that every long, dark night is followed by a blaze of glory. The bitters are like that first ray of sun—sharp and full of promise. Simple, potent, and gets you ready for another day's ride." },
            { name: "The Gilded Serpent", category: ["tequila", "schnapps"], flavorProfile: "Floral & Sharp", recipe: ["1.5 oz El Mayor Tequila", "0.75 oz St-Germain", "1 oz Pineapple Juice", "0.5 oz Lime Juice"], story: "Named after a custom gold-plated chopper that was beautiful but rumored to be cursed. This drink is the same—alluringly sweet and floral at first, but the tequila's bite is a sharp reminder that beauty can be deceiving. It's a beautiful risk." },
            { name: "Mad Dog", category: ["dogs", "vodka"], flavorProfile: "Tart & Salty", recipe: ["2 oz Grey Goose Vodka", "Fill a tall glass with Cranberry Juice", "Salt Rim"], story: "The Salty Dog got put down. This is what's left. It's meaner, redder, and bites back twice as hard. It’s for the days when your engine seizes and your patience has seized right along with it. This won't fix your bike, but it'll make you not care for a while." },
            { name: "The Switchblade", category: ["dogs", "vodka"], flavorProfile: "Intensely Sour", recipe: ["2 oz Stolichnaya Citros Vodka", "1 oz Lemon Juice", "0.75 oz Simple Syrup", "Sugar Rim"], story: "A rider they called 'Showtime' used to order these. Looked like a pretty boy, rode like a demon. The drink is the same: starts sweet, but the sour kick hits you like a pothole at 90 mph. It's deceptively dangerous." },
            { name: "The Junkyard Dog", category: ["dogs", "schnapps"], flavorProfile: "Herbal & Sweet", recipe: ["1 oz Jägermeister", "1 oz Southern Comfort", "0.5 oz Lime Juice", "Serve on the rocks"], story: "This drink is like a bike built from spare parts—it doesn't look like it should work, but somehow it runs like a beast. A little bit of this, a little bit of that, and a whole lot of attitude. It's surprisingly good, and it'll bite you if you don't respect it." },
            { name: "The Wrench's Sidecar", category: ["classics", "schnapps"], flavorProfile: "Strong & Citrus", recipe: ["2 oz E&J Brandy", "1 oz Cointreau", "0.75 oz Lemon Juice", "Sugar Rim"], story: "This ain't for the faint of heart. Our head mechanic, Gus, drinks this after a full day of wrestling with stubborn engines. He says it's strong enough to strip rust and smooth enough to make you forget the busted knuckles. A true classic, rebuilt for power." },
            { name: "The Blackout", category: ["schnapps"], flavorProfile: "Herbal & Dark", recipe: ["1.5 oz Jägermeister", "Fill a tall glass with Cola"], story: "A rider named 'Crow' only drank this. Said it was simple, effective, and reminded him of riding at night with a busted headlight. You don't see what's coming, you just feel it. A few of these and everything fades to black." },
            { name: "Peaches 'n' Scream", category: ["schnapps", "whiskey"], flavorProfile: "Sweet Peach & Bold", recipe: ["1.5 oz Peach Schnapps", "0.5 oz Southern Comfort", "Fill a tall glass with Orange Juice"], story: "Named after a biker's girlfriend who was sweet as a peach until you crossed her, then she'd scream loud enough to shatter glass. This drink is the same. It lures you in with sweetness, then the whiskey kick reminds you who's boss." },
            { name: "The Outlaw's Peach", category: ["schnapps"], flavorProfile: "Creamy Peach", recipe: ["1 oz Peach Schnapps", "1 oz Baileys Irish Cream", "Top with Cola in a tall glass"], story: "Looks smooth and creamy, but it's got a sweet, rebellious streak. Named for a biker who'd rob you blind with a smile on his face. It goes down easy, but you'll be wondering what hit you." },
            { name: "The Apricot Ambush", category: ["schnapps", "signature"], flavorProfile: "Fruity & Tart", recipe: ["1.5 oz E&J Brandy", "0.75 oz Apricot Brandy", "0.5 oz Lemon Juice", "Top with Club Soda"], story: "Looks innocent, like a sweet summer ride. Then the double-brandy kick comes out of nowhere and lays you out. It’s a smooth, fruity ride straight into a ditch of your own making. You won't see it coming." },
            { name: "The Crimson Guard", category: ["schnapps", "gin"], flavorProfile: "Fruity & Sharp", recipe: ["1.5 oz Sloe Gin", "0.5 oz Tanqueray Gin", "Fill a tall glass with Club Soda", "Splash of Lime Juice"], story: "Named for the old guard who protect the club's colors. It's deep red like the patches, sharp like their attitude, and the gin kick reminds you they've still got plenty of fight left in them. It's a drink that commands respect." },
            { name: "The Road Rash", category: ["schnapps", "whiskey"], flavorProfile: "Sweet & Sour", recipe: ["1 oz Sloe Gin", "1 oz Southern Comfort", "0.5 oz Lemon Juice", "Fill a tall glass with Club Soda"], story: "We named this after a prospect took a spill and came in looking scraped up but proud. It's a little sweet, a little sour, and has a color like a healing wound. It's a reminder that a few scars just mean you've got a good story to tell." },
            { name: "The Ruby Rider", category: ["schnapps"], flavorProfile: "Deep & Fruity", recipe: ["2 oz Sloe Gin", "Fill a tall glass with Ginger Soda"], story: "A woman who rides a deep ruby-red Indian Scout orders this. It's her signature. Simple, elegant, but with a deep, fruity complexity that takes you by surprise. It's proof that you don't have to be loud to make a statement." },
            { name: "Cowboy's Hard Root Beer", category: ["whiskey", "schnapps"], flavorProfile: "Creamy & Bold", recipe: ["1.5 oz Jameson Irish Whiskey", "1 oz Root Beer Schnapps", "0.5 oz Simple Syrup", "Top with Club Soda in a tall glass"], story: "This is Cowboy's signature drink. He'd mix it himself after a long ride, saying it had the sweetness of a memory and the kick of a cold start on a winter morning. It's a taste of the open road, straight from the man himself." },
            { name: "Knob Creek Kentucky Smash", category: ["whiskey"], flavorProfile: "Strong & Sour", recipe: ["2 oz Knob Creek", "1 oz Lemon Juice", "0.75 oz Simple Syrup", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "A rider we call 'Wrench' drinks this. He says it's like rebuilding an engine: you need sour for the challenge, sweet for the satisfaction, and a bitter kick to remember it ain't always easy. Gets the job done." },
            { name: "The Gilded Cage", category: ["whiskey", "schnapps"], flavorProfile: "Rich & Nutty", recipe: ["1.5 oz Crown Royal", "0.5 oz Amaretto", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "For the rider who's got it all but still yearns for the open road. It's smooth and rich, but that ginger and spiced bitter kick is a constant reminder of the freedom that lies just beyond the horizon. Tastes like luxury with an edge of rebellion." },
            { name: "Bulleit Frontier Punch", category: ["whiskey"], flavorProfile: "Fruity & Bold", recipe: ["2 oz Bulleit Bourbon", "2 oz Orange Juice", "0.5 oz Lemon Juice", "Splash of Grenadine", "Top with Club Soda in a tall glass"], story: "A group riding cross-country stops in every year. They order a round of these to wash away the trail dust. They say it tastes like a prairie sunset—a flash of sweet color after a long, hard, spicy ride." },
            { name: "Seagram's Stone Sour", category: ["whiskey"], flavorProfile: "Classic Sour", recipe: ["2 oz Seagram's 7", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "Splash of Orange Juice", "2 dashes Peychaud's Bitters", "Top with Club Soda in a tall glass"], story: "Everyone knows the simple Seagram's mix. A rider named 'Gus' asked us to give it some guts. We came up with this. He says it’s like his old bike—familiar, reliable, but with a few custom modifications, like those Peychaud's, that make it hit a whole lot harder and taste like nowhere else on earth." },
            { name: "Jim Beam Black Cherry Bomb", category: ["whiskey", "schnapps"], flavorProfile: "Bold Cherry", recipe: ["2 oz Jim Beam Bourbon", "0.5 oz Cherry Schnapps", "Fill a tall glass with Cola"], story: "This is for the new bloods who think they know it all. It starts off familiar, like a classic ride. Then that cherry kick hits and reminds them that even the old standards have a few surprises left. It’s a lesson in a glass." },
            { name: "Southern Crossroads", category: ["whiskey", "schnapps"], flavorProfile: "Sweet & Fruity", recipe: ["1.5 oz Southern Comfort", "0.5 oz Sloe Gin", "Fill a tall glass with Orange Juice"], story: "A musician on a beat-up bike once asked for a drink that tasted like 'making a deal with the devil at midnight.' This is it. It’s sweet, it's deep, and it has a strange, fruity tang that makes you wonder if you made the right choice." },
            { name: "The Red Label Rider", category: ["whiskey", "classics"], flavorProfile: "Smoky & Sharp", recipe: ["2 oz Johnnie Walker Red Label", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This is for the old-school rider on the vintage Norton. No frills, just a classic profile with a smoky kick and a spicy finish that tells you it's seen a few miles. It's the taste of heritage with an attitude." },
            { name: "The Bitter End", category: ["whiskey", "schnapps"], flavorProfile: "Bitter & Spiced", recipe: ["1.5 oz Four Roses Whiskey", "0.75 oz Campari", "2 dashes Angostura Bitters", "Fill a tall glass with Club Soda"], story: "Some rides don't have a happy ending. This drink is for those times. It's strong from the whiskey, bitter from the Campari, and spiced with the harsh reality of the road. It’s a salute to the journeys that make you, and break you." },
            { name: "Old Fashioned", category: ["classics", "whiskey"], flavorProfile: "Bold & Bitter", recipe: ["2 oz Maker's Mark", "0.5 oz Simple Syrup", "2 dashes Orange Bitters", "Cherry Garnish", "Top with Club Soda in a tall glass"], story: "Old Man Hemlock only drinks this. He says, 'You don't need a thousand new parts to make a bike run true, and you don't need a thousand ingredients for a real drink.' It’s a testament to doing things the right way, no matter how long it takes." },
            { name: "Margarita", category: ["classics", "tequila", "schnapps"], flavorProfile: "Salty & Sour", recipe: ["2 oz Jose Cuervo Silver Tequila", "1 oz Cointreau", "1 oz Lime Juice", "2 dashes Orange Bitters", "Salt Rim", "Top with Club Soda in a tall glass"], story: "A few guys rode in from Arizona, covered in dust and looking for trouble. They ordered a round of these. By the third, the stories got wilder and the bikes got shinier. We add bitters to ours—it's the secret ingredient that makes a long, hard ride legendary." },
            { name: "Moscow Mule", category: ["classics", "vodka"], flavorProfile: "Spicy Ginger", recipe: ["2 oz Ketel One Vodka", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "A prospect once complained his bike was kicking back on him. The club president handed him one of these and said, 'Now you've got something that kicks back even harder. The bitters are an extra kick to the gut. One of 'em you'll learn to handle.' The kid learned to respect both." },
            { name: "Gin and Tonic", category: ["classics", "gin"], flavorProfile: "Crisp & Bitter", recipe: ["2 oz Tanqueray Gin", "Fill a tall glass with Tonic Water"], story: "This is for the Road Captain. The guy who knows every route, every stop, and every pothole for five states. It's not flashy, but it's reliable and gets the job done right, every single time. A dash of bitters is like his signature on a map—a mark of experience." },
            { name: "Screwdriver", category: ["classics", "vodka"], flavorProfile: "Simple Citrus", recipe: ["2 oz Stolichnaya Citros Vodka", "2 dashes Orange Bitters", "Fill a tall glass with Orange Juice"], story: "Knew a guy who swore he could fix his bike's wiring with nothing but a screwdriver and a flask of this. Don't know about the wiring, but adding bitters is like using the right tool for the job—it just works better. Sometimes the best fix is an upgrade." },
            { name: "Whiskey Sour", category: ["classics", "whiskey"], flavorProfile: "Sour & Sweet", recipe: ["2 oz Jim Beam Bourbon", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "2 dashes Angostura Bitters", "Top with Club Soda in a tall glass"], story: "A prospect once complained his mouth was as dry as the desert highway. We gave him this. The sour kick woke him up, the spice from the bitters reminded him of the journey, and the sweet finish promised a smooth patch of road ahead." },
            { name: "Cuba Libre", category: ["classics", "rum"], flavorProfile: "Spiced Lime", recipe: ["2 oz Bacardi Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Cola"], story: "Every biker talks about freedom. The open road, no rules. This drink is the liquid version of that. The bitters add a touch of the unknown, for when you're planning a cross-country trip with no map, just a direction. Tastes like breaking away from the pack for good." },
            { name: "The Oath", category: ["classics", "whiskey", "schnapps"], flavorProfile: "Bold & Almond", recipe: ["2 oz Bulleit Bourbon", "0.75 oz Amaretto", "Serve on the rocks"], story: "This isn't for a night on the town. This is for when two riders make a pact—a promise sealed not with a handshake, but with the burn of good bourbon and the subtle sweetness of brotherhood. It’s a drink that says more than words ever could. Simple, strong, and binding." },
            { name: "White Russian", category: ["classics", "vodka", "schnapps"], flavorProfile: "Creamy Coffee", recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream", "Top with Cola in a tall glass"], story: "We call this 'The Ghost.' A quiet rider, always in white leathers, would order one, drink it slow, and leave without a word. Never knew his name. He was just a legend that drifted in and out, smooth and mysterious, just like the drink." },
            { name: "Long Island Iced Tea", category: ["classics", "vodka", "gin", "rum", "tequila", "schnapps"], flavorProfile: "Strong & Sour", recipe: ["0.5 oz Grey Goose Vodka", "0.5 oz Tanqueray Gin", "0.5 oz Bacardi Rum", "0.5 oz Jose Cuervo Silver Tequila", "0.5 oz Cointreau", "1 oz Lemon Juice", "Fill a tall glass with Cola"], story: "A guy once bet he could build an engine after drinking three of these. He didn't build an engine, but he did try to use a jukebox as a telephone and offered to trade his leather jacket for a half-eaten plate of nachos. This drink has a way of rewriting your priorities." }
        ];

        // --- Config & Global State ---
        let barStock = {};
        const STOCK_STORAGE_KEY = 'nomads_bar_stock_v2';
        const titleFonts = ['Rye', 'Bangers', 'Creepster', 'Metal Mania', 'Nosifier', 'Permanent Marker'];
        const ingredientCategories = {
            'Spirits': {
                'Whiskey & Bourbon': ['Bulleit Bourbon', 'Crown Royal', 'Four Roses Whiskey', 'Jameson Irish Whiskey', 'Jim Beam Bourbon', 'Johnnie Walker Red Label', 'Knob Creek', 'Maker\'s Mark', 'Seagram\'s 7', 'Southern Comfort'],
                'Vodka': ['Grey Goose Vodka', 'Ketel One Vodka', 'Stolichnaya Citros Vodka'], 'Gin': ['Tanqueray Gin', 'Sloe Gin'],
                'Rum': ['Bacardi Rum', 'Captain Morgan Spiced Rum', 'Kraken Black Spiced Rum', 'Malibu Rum'],
                'Tequila': ['El Mayor Tequila', 'Jose Cuervo Silver Tequila'], 'Brandy': ['E&J Brandy', 'Apricot Brandy'],
            },
            'Liqueurs & Schnapps': {
                'Fruit': ['Apple Pucker', 'Blue Curacao', 'Cherry Schnapps', 'Cointreau', 'Maraschino Liqueur', 'Peach Schnapps', 'Raspberry Schnapps'],
                'Herbal & Spiced': ['Campari', 'Jägermeister', 'Pernod', 'St-Germain'],
                'Cream, Nut & Coffee': ['Amaretto', 'Baileys Irish Cream', 'Kahlúa'],
                'Other Schnapps': ['Butterscotch Schnapps', 'Root Beer Schnapps']
            },
            'Mixers & Bitters': {
                'Sodas & Juices': ['Club Soda', 'Cola', 'Cranberry Juice', 'Ginger Soda', 'Lemon Juice', 'Lime Juice', 'Orange Juice', 'Pineapple Juice', 'Sour Mix', 'Tonic Water'],
                'Bitters': ['Angostura Bitters', 'Orange Bitters', 'Peychaud\'s Bitters', 'Rosemary Lavender Bitters'],
                'Syrups': ['Grenadine', 'Simple Syrup'],
            },
            'Other': { 'Garnish & Rims': ['Cherry Garnish', 'Half Salt, Half Sugar Rim', 'Salt Rim', 'Sugar Rim'] }
        };

        // --- DOM Elements ---
        const menuGrid = document.getElementById('menu-grid');
        const barStockModal = document.getElementById('bar-stock-modal');
        const drinkFinderModal = document.getElementById('drink-finder-modal');

        // --- Helper Functions ---
        function parseIngredientName(ingStr) {
            let name = ingStr.replace(/^[\d./\s-]+(oz|dashes|dash|garnish)\s*/i, '');
            const instructionalPhrases = [ 'Fill a tall glass with ', 'Fill with ', 'Top with ', 'Splash of ', 'Splash '];
            for (const phrase of instructionalPhrases) {
                if (name.toLowerCase().startsWith(phrase.toLowerCase())) {
                    name = name.substring(phrase.length);
                    const inIndex = name.toLowerCase().indexOf(' in a');
                    if (inIndex > -1) name = name.substring(0, inIndex);
                    break;
                }
            }
            const pureInstructions = ['serve on the rocks'];
            if(pureInstructions.includes(name.toLowerCase().trim())) return null;
            return name.trim();
        }

        function getIconForIngredient(ingredientName) {
            const lowerIng = ingredientName.toLowerCase();
            if (['whiskey', 'bourbon', 'southern comfort', 'maker\'s mark', 'seagram\'s 7', 'knob creek', 'crown royal', 'bulleit', 'jim beam', 'johnnie walker', 'four roses'].some(s => lowerIng.includes(s))) return { icon: 'fa-whiskey-glass', color: 'text-orange-400' };
            if (['vodka'].some(s => lowerIng.includes(s))) return { icon: 'fa-skull-crossbones', color: 'text-blue-300' };
            if (['gin'].some(s => lowerIng.includes(s))) return { icon: 'fa-leaf', color: 'text-green-400' };
            if (['rum', 'malibu'].some(s => lowerIng.includes(s))) return { icon: 'fa-anchor', color: 'text-yellow-800' };
            if (['tequila'].some(s => lowerIng.includes(s))) return { icon: 'fa-hat-cowboy-side', color: 'text-yellow-600' };
            if (['brandy'].some(s => lowerIng.includes(s))) return { icon: 'fa-solid fa-wine-glass', color: 'text-purple-400'};
            if (['schnapps', 'pucker', 'jägermeister', 'liqueur', 'baileys', 'pernod', 'kahlúa', 'st-germain', 'cointreau', 'amaretto', 'campari', 'blue curacao'].some(l => lowerIng.includes(l))) return { icon: 'fa-mortar-pestle', color: 'text-purple-400' };
            if (lowerIng.includes('bitters')) return { icon: 'fa-eye-dropper', color: 'text-red-500' };
            if (['juice', 'sour mix'].some(j => lowerIng.includes(j))) return { icon: 'fa-lemon', color: 'text-yellow-400' };
            if (['soda', 'tonic', 'cola'].some(m => lowerIng.includes(m))) return { icon: 'fa-faucet-drip', color: 'text-gray-400' };
            if (['syrup', 'grenadine'].some(s => lowerIng.includes(s))) return { icon: 'fa-prescription-bottle', color: 'text-pink-400' };
            if (lowerIng.includes('rim')) return { icon: 'fa-solid fa-circle-notch', color: 'text-gray-300'};
            if (lowerIng.includes('garnish')) return { icon: 'fa-solid fa-leaf', color: 'text-green-300'};
            return { icon: 'fa-cube', color: 'text-gray-400' };
        }

        function highlightAndScrollToCard(card) {
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            document.querySelectorAll('.is-highlighted').forEach(c => c.classList.remove('is-highlighted'));
            card.classList.add('is-highlighted');
            setTimeout(() => card.classList.remove('is-highlighted'), 2500);
        }
        
        function generateReviews(drinkName) {
            const reviews = [];
            const reviewPool = {
                praises: ["Hits like a freight train.", "Smooth as a fresh paved road.", "Got a kick like a seized engine.", "A real knockout.", "My new go-to.", "Exactly what I needed after a long haul.", "Not for the faint of heart."],
                descriptors: ["Surprisingly sweet.", "Deceptively strong.", "A bitter pill, but a good one.", "Woke me right up.", "Tastes like trouble."],
                authors: ["Road Rash Ricky", "Gus 'The Wrench'", "Crow", "Showtime", "Old Man Hemlock", "Roxy", "Finn", "A quiet rider"]
            };
            
            // Simple hashing to get a "random" but consistent index
            const nameHash = drinkName.split('').reduce((acc, char) => char.charCodeAt(0) + acc, 0);
            
            const review1Text = `${reviewPool.praises[nameHash % reviewPool.praises.length]} ${reviewPool.descriptors[(nameHash + 1) % reviewPool.descriptors.length]}`;
            const review1Author = reviewPool.authors[nameHash % reviewPool.authors.length];
            reviews.push({ text: review1Text, author: review1Author });

            // Add a second, different review sometimes
            if (nameHash % 3 === 0) {
                 const review2Text = `${reviewPool.praises[(nameHash + 3) % reviewPool.praises.length]}`;
                 const review2Author = reviewPool.authors[(nameHash + 1) % reviewPool.authors.length];
                 if(review2Author !== review1Author) { // ensure author is different
                    reviews.push({ text: review2Text, author: review2Author });
                 }
            }
            return reviews;
        }

        // --- Bar Stock Functions ---
        function initializeBarStock() {
            const allIngredients = Object.values(ingredientCategories).flatMap(mainCat => Object.values(mainCat).flat()).sort();
            const savedStock = localStorage.getItem(STOCK_STORAGE_KEY);
            if (savedStock) {
                barStock = JSON.parse(savedStock);
                allIngredients.forEach(ing => { if (barStock[ing] === undefined) barStock[ing] = true; });
            } else {
                allIngredients.forEach(ing => barStock[ing] = true);
            }
            localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(barStock));
            renderBarStockModal();
        }

        function renderBarStockModal() {
            const inStockContainer = document.getElementById('in-stock-lists');
            const outOfStockContainer = document.getElementById('out-of-stock-lists');
            inStockContainer.innerHTML = ''; outOfStockContainer.innerHTML = '';

            const renderButtonsForStatus = (status) => {
                let html = '';
                Object.keys(ingredientCategories).forEach(mainCategoryName => {
                    let mainCategoryHtml = ''; let hasContentInMainCategory = false;
                    Object.keys(ingredientCategories[mainCategoryName]).forEach(subCategoryName => {
                        const subCategoryIngredients = ingredientCategories[mainCategoryName][subCategoryName]
                            .filter(ing => barStock[ing] === status)
                            .map(ing => `<button data-ingredient="${ing}" class="ingredient-btn ${!status ? 'out-of-stock' : ''} text-sm bg-gray-700 hover:bg-gray-600 text-white py-1 px-4 rounded-lg transition-colors">${ing}</button>`)
                            .join('');
                        if (subCategoryIngredients.length > 0) {
                            hasContentInMainCategory = true;
                            mainCategoryHtml += `<div class="mb-3"><h5 class="text-md font-bold text-gray-400 mb-2">${subCategoryName}</h5><div class="flex flex-wrap gap-2">${subCategoryIngredients}</div></div>`;
                        }
                    });
                    if (hasContentInMainCategory) html += `<div class="mb-6"><h4 class="text-xl font-rye text-amber-500 mb-3 border-b-2 border-gray-600 pb-2">${mainCategoryName}</h4>${mainCategoryHtml}</div>`;
                });
                return html;
            };
            inStockContainer.innerHTML = renderButtonsForStatus(true);
            outOfStockContainer.innerHTML = renderButtonsForStatus(false);
        }
        
        function isDrinkMakeable(drink) {
            if (!drink.recipe) return true;
            return drink.recipe.every(ingStr => {
                const ingName = parseIngredientName(ingStr);
                if (ingName === null) return true; 
                return barStock[ingName] !== false;
            });
        }

        function toggleStock(ingredient) {
            barStock[ingredient] = !barStock[ingredient];
            localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(barStock));
            renderBarStockModal();
            const activeBtn = document.querySelector('#category-filter-container .category-pill.is-active');
            if (activeBtn) filterMenu(activeBtn.dataset.category, activeBtn, true);
        }

        // --- Menu Rendering & Filtering ---
        function renderMenu(itemsToRender) {
            menuGrid.innerHTML = '';
            itemsToRender.forEach((item, index) => {
                const isUnavailable = !isDrinkMakeable(item);
                const titleFont = titleFonts[index % titleFonts.length];
                
                const cardHtml = `
                    <div class="drink-card ${isUnavailable ? 'is-unavailable' : ''}" data-name="${item.name}" data-category="${item.category[0]}">
                        <div class="drink-card-inner">
                            <div class="drink-card-front">
                                <div class="card-header-front"><h3 class="drink-card-title" style="font-family: '${titleFont}', cursive; line-height: 1.1;">${item.name}</h3></div>
                                
                                <div class="px-4 pt-4 text-center">
                                    <h4 class="recipe-content-title">Flavor Profile</h4>
                                    <p class="font-rye text-amber-300 text-lg">${item.flavorProfile}</p>
                                </div>

                                <div class="recipe-content">
                                    <h4 class="recipe-content-title mt-2">Recipe</h4>
                                    <ul class="recipe-list-front">
                                        ${item.recipe.map(r => {
                                            const ingName = parseIngredientName(r) || r;
                                            const ingInfo = getIconForIngredient(ingName);
                                            return `<li><i class="fas ${ingInfo.icon} ${ingInfo.color}"></i><span>${r}</span></li>`;
                                        }).join('')}
                                    </ul>
                                </div>
                                <div class="card-footer">Tap for the Legend</div>
                            </div>
                            <div class="drink-card-back">
                               <div class="p-4 flex flex-col flex-grow overflow-y-auto">
                                    <p class="text-gray-300 italic leading-relaxed">"${item.story}"</p>
                                    <div class="border-t-2 border-dashed border-gray-600 my-4"></div>
                                    <div>
                                        <h4 class="recipe-content-title text-center mb-2">Word on the Street</h4>
                                        <div class="text-sm space-y-2 text-gray-400">
                                            ${generateReviews(item.name).map(review => `
                                                <div class="bg-black/20 p-2 rounded-md shadow-inner">
                                                    <p>"${review.text}"</p>
                                                    <p class="text-right text-xs text-amber-500/70 font-rye">- ${review.author}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">Tap for Recipe</div>
                            </div>
                        </div>
                    </div>`;
                menuGrid.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function renderCategories() {
            const categoryContainer = document.getElementById('category-filter-container');
            const categoryCounts = {};
            cocktails.forEach(cocktail => {
                cocktail.category.forEach(cat => {
                    categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
                });
            });

            const mainCategories = ['signature', 'classics', 'dogs', 'whiskey', 'vodka', 'gin', 'rum', 'tequila', 'schnapps'];
            const displayedCategories = ['all', ...mainCategories.filter(cat => categoryCounts[cat] >= 3)];

            categoryContainer.innerHTML = displayedCategories.map((cat) => {
                const buttonText = cat === 'all' ? 'DILLIGAF' : cat.charAt(0).toUpperCase() + cat.slice(1);
                return `<button data-category="${cat}" class="category-pill">${buttonText}</button>`;
            }).join('');
        }

        function filterMenu(category, btnElement, forceRender = false) {
            if (!forceRender) {
                document.querySelectorAll('#category-filter-container .category-pill.is-active').forEach(b => b.classList.remove('is-active'));
                if (btnElement) btnElement.classList.add('is-active');
            }
            const itemsToRender = category === 'all' ? cocktails : cocktails.filter(item => item.category.includes(category));
            renderMenu(itemsToRender);
        }
        
        // --- Drink Finder Functions ---
        function initializeDrinkFinder() {
            const flavorTagsContainer = document.getElementById('finder-flavor-tags');
            const allFlavors = new Set();
            cocktails.forEach(c => {
                if(c.flavorProfile) {
                    c.flavorProfile.split(/, | & /).forEach(f => {
                        const trimmed = f.trim();
                        if (trimmed) allFlavors.add(trimmed);
                    });
                }
            });
            flavorTagsContainer.innerHTML = Array.from(allFlavors).sort().map(flavor => 
                `<button data-flavor="${flavor}" class="category-pill">${flavor}</button>`
            ).join('');
        }
        
        function findMatchingDrinks() {
            const resultsContainer = document.getElementById('finder-results');
            const selectedButton = document.querySelector('#finder-flavor-tags .category-pill.is-active');

            if (!selectedButton) {
                resultsContainer.innerHTML = '<p class="text-gray-500 italic">Select a flavor to find a match.</p>';
                return;
            }

            const selectedFlavor = selectedButton.dataset.flavor;
            const matches = cocktails.filter(drink => {
                if (!drink.flavorProfile) return false;
                const drinkFlavors = new Set(drink.flavorProfile.split(/, | & /).map(f => f.trim()));
                return drinkFlavors.has(selectedFlavor);
            });

            if (matches.length > 0) {
                 resultsContainer.innerHTML = matches.map(drink => `
                    <button data-drink-name="${drink.name}" class="finder-result-btn w-full text-left p-3 bg-gray-700 hover:bg-amber-800 rounded-lg transition-colors flex justify-between items-center">
                        <span class="font-bold text-lg text-amber-400">${drink.name}</span>
                        <span class="text-xs text-gray-400">${drink.flavorProfile}</span>
                    </button>`).join('');
            } else {
                resultsContainer.innerHTML = '<p class="text-red-400 font-semibold">No drinks match this flavor.</p>';
            }
        }
        
        // --- Event Listeners & Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initial render
            renderCategories();
            initializeBarStock();
            initializeDrinkFinder();
            filterMenu('all', document.querySelector('#category-filter-container .category-pill[data-category="all"]'));

            // DELEGATED EVENT LISTENER FOR CATEGORY CLICKS (THE FIX)
            document.getElementById('category-filter-container').addEventListener('click', e => {
                if (e.target.matches('.category-pill')) {
                    filterMenu(e.target.dataset.category, e.target);
                }
            });

            // Card flips
            menuGrid.addEventListener('click', e => {
                const card = e.target.closest('.drink-card');
                if (card) card.classList.toggle('is-flipped');
            });

            // Arrow navigation
            document.getElementById('arrow-left').addEventListener('click', () => menuGrid.scrollBy({ left: -(menuGrid.clientWidth * 0.9), behavior: 'smooth' }));
            document.getElementById('arrow-right').addEventListener('click', () => menuGrid.scrollBy({ left: menuGrid.clientWidth * 0.9, behavior: 'smooth' }));
            
            // Bottom navigation button clicks
            document.querySelectorAll('.bottom-nav-btn').forEach(btn => btn.addEventListener('click', (e) => {
                 document.querySelectorAll('.bottom-nav-btn').forEach(b => b.classList.remove('is-active'));
                 e.currentTarget.classList.add('is-active');
            }));

            document.getElementById('home-btn').addEventListener('click', () => {
                const allButton = document.querySelector('#category-filter-container .category-pill[data-category="all"]');
                if (allButton) {
                    filterMenu('all', allButton);
                    allButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });

            document.getElementById('roll-dice-btn').addEventListener('click', () => {
                const makeableCards = Array.from(document.querySelectorAll('.drink-card:not(.is-unavailable)'));
                if (makeableCards.length > 0) {
                    const randomCard = makeableCards[Math.floor(Math.random() * makeableCards.length)];
                    highlightAndScrollToCard(randomCard);
                }
            });
            
            // Modal toggles & interactions
            document.getElementById('bar-stock-btn').addEventListener('click', () => {
                barStockModal.classList.remove('hidden');
                setTimeout(() => barStockModal.classList.remove('opacity-0'), 10);
            });
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                barStockModal.classList.add('opacity-0');
                setTimeout(() => barStockModal.classList.add('hidden'), 300);
            });
            barStockModal.addEventListener('click', (e) => {
                if(e.target.closest('.ingredient-btn')) toggleStock(e.target.closest('.ingredient-btn').dataset.ingredient);
            });

            document.getElementById('drink-finder-btn').addEventListener('click', () => {
                drinkFinderModal.classList.remove('hidden');
                setTimeout(() => drinkFinderModal.classList.remove('opacity-0'), 10);
            });
            document.getElementById('close-finder-btn').addEventListener('click', () => {
                drinkFinderModal.classList.add('opacity-0');
                setTimeout(() => drinkFinderModal.classList.add('hidden'), 300);
            });
            document.getElementById('finder-flavor-tags').addEventListener('click', e => {
                if (e.target.matches('.category-pill')) {
                    const targetButton = e.target;
                    const isActive = targetButton.classList.contains('is-active');

                    // Deselect all other buttons first
                    document.querySelectorAll('#finder-flavor-tags .category-pill').forEach(btn => btn.classList.remove('is-active'));

                    // If the button was not already active, make it active.
                    // This allows clicking an active button to deselect it.
                    if (!isActive) {
                        targetButton.classList.add('is-active');
                    }
                    
                    findMatchingDrinks();
                }
            });
            document.getElementById('finder-results').addEventListener('click', (e) => {
                const resultBtn = e.target.closest('.finder-result-btn');
                if (resultBtn) {
                    const card = document.querySelector(`.drink-card[data-name="${resultBtn.dataset.drinkName}"]`);
                    if (card) {
                        highlightAndScrollToCard(card);
                        drinkFinderModal.classList.add('opacity-0');
                        setTimeout(() => drinkFinderModal.classList.add('hidden'), 300);
                    }
                }
            });
        });
    </script>
</body>
</html>



